<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Fraud Detector</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A light blue-gray background */
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease-in-out;
        }
        .form-input {
            border-radius: 8px;
            border: 1px solid #d1d5db;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .btn {
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .result-card {
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            color: white;
            display: none; /* Hidden by default */
        }
        .result-safe {
            background: linear-gradient(135deg, #2dd4bf, #0d9488);
        }
        .result-fraud {
            background: linear-gradient(135deg, #f87171, #dc2626);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Credit Card Fraud Detector</h1>
            <p class="text-lg text-gray-600 mt-2">An ML-powered tool to predict transaction authenticity.</p>
        </header>

        <div class="card p-8">
            <!-- Main Form -->
            <form id="prediction-form">
                <h2 class="text-2xl font-semibold text-gray-700 mb-6">Enter Transaction Details</h2>

                <!-- Time and Amount Fields -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700 mb-1">Time (seconds since first transaction)</label>
                        <input type="number" step="any" id="time" name="time" class="form-input w-full p-2" placeholder="e.g., 40743" required>
                    </div>
                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Transaction Amount ($)</label>
                        <input type="number" step="any" id="amount" name="amount" class="form-input w-full p-2" placeholder="e.g., 25.00" required>
                    </div>
                </div>

                <!-- V1-V28 Fields (collapsible) -->
                <details class="mb-6">
                    <summary class="text-lg font-medium text-gray-600 cursor-pointer hover:text-gray-800">
                        Advanced Features (V1-V28)
                    </summary>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4 p-4 bg-gray-50 rounded-lg">
                        <!-- Fields will be generated by JS -->
                    </div>
                </details>
                
                <!-- Sample Data Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 mb-6">
                    <button type="button" id="fill-normal" class="btn bg-green-500 hover:bg-green-600 text-white w-full py-2">Fill with Sample NORMAL Data</button>
                    <button type="button" id="fill-fraud" class="btn bg-red-500 hover:bg-red-600 text-white w-full py-2">Fill with Sample FRAUD Data</button>
                </div>


                <!-- Submit Button -->
                <div class="text-center">
                    <button type="submit" id="submit-btn" class="btn btn-primary w-full md:w-1/2 py-3 text-lg">
                        <span id="submit-text">Analyze Transaction</span>
                        <div id="spinner" class="hidden h-5 w-5 border-t-2 border-r-2 border-white rounded-full animate-spin mx-auto"></div>
                    </button>
                </div>
            </form>
        </div>

        <!-- Result Display Area -->
        <div id="result-area" class="mt-8">
            <!-- This will be populated by JS -->
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('prediction-form');
            const resultArea = document.getElementById('result-area');
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const spinner = document.getElementById('spinner');

            // --- Generate V1-V28 input fields ---
            const advancedFieldsContainer = document.querySelector('details div');
            for (let i = 1; i <= 28; i++) {
                const v_field_html = `
                    <div>
                        <label for="V${i}" class="block text-xs font-medium text-gray-600">V${i}</label>
                        <input type="number" step="any" id="V${i}" name="V${i}" class="form-input w-full p-1.5 text-sm" placeholder="0.0">
                    </div>
                `;
                advancedFieldsContainer.innerHTML += v_field_html;
            }

            // --- Sample Data ---
            // These are real (but anonymized) examples from the dataset
            const normalSample = {
                time: 40743.0, amount: 25.0, V1: 1.22438, V2: -0.42363, V3: 0.94693, V4: -0.66921, V5: -1.08531, V6: -0.45428, V7: -0.79253, V8: 0.05958, V9: -1.22432, V10: 0.53339, V11: 0.87884, V12: -0.83868, V13: -0.32766, V14: -0.22356, V15: 0.83533, V16: 0.44141, V17: 0.17054, V18: -0.21338, V19: 0.56321, V20: -0.1604, V21: -0.05391, V22: -0.04358, V23: -0.04680, V24: 0.02491, V25: 0.48899, V26: 0.93333, V27: -0.03124, V28: 0.01546
            };
            const fraudSample = {
                time: 406.0, amount: 1.0, V1: -2.31223, V2: 1.95199, V3: -1.60985, V4: 3.99791, V5: -0.52219, V6: -1.42654, V7: -2.53739, V8: 1.39166, V9: -2.77009, V10: -2.77227, V11: 3.20203, V12: -2.89991, V13: -0.59522, V14: -4.28925, V15: 0.38972, V16: -1.14075, V17: -2.83006, V18: -0.01682, V19: 0.41695, V20: 0.12691, V21: 0.51723, V22: -0.03505, V23: -0.46521, V24: 0.32017, V25: 0.04452, V26: 0.17784, V27: 0.26115, V28: -0.14327
            };

            // --- Event Listeners for Sample Data ---
            document.getElementById('fill-normal').addEventListener('click', () => fillForm(normalSample));
            document.getElementById('fill-fraud').addEventListener('click', () => fillForm(fraudSample));

            function fillForm(sample) {
                Object.keys(sample).forEach(key => {
                    const input = document.getElementById(key.toUpperCase());
                    if (input) {
                        input.value = sample[key];
                    } else if (key === 'time' || key === 'amount') {
                        document.getElementById(key).value = sample[key];
                    }
                });
                // Open details if closed
                document.querySelector('details').open = true;
            }

            // --- Form Submission Logic ---
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                showLoading(true);
                resultArea.innerHTML = '';

                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                try {
                    const response = await fetch('/predict', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const result = await response.json();
                    displayResult(result);

                } catch (error) {
                    console.error('Error:', error);
                    displayResult({ error: 'Failed to get a prediction. Is the server running?' });
                } finally {
                    showLoading(false);
                }
            });

            function showLoading(isLoading) {
                if (isLoading) {
                    submitText.classList.add('hidden');
                    spinner.classList.remove('hidden');
                    submitBtn.disabled = true;
                } else {
                    submitText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                    submitBtn.disabled = false;
                }
            }

            function displayResult(result) {
                let resultCardHTML = '';
                if (result.error) {
                    resultCardHTML = `
                        <div class="result-card" style="background: #ef4444; display: block;">
                            <h3 class="text-2xl font-bold mb-2">Error</h3>
                            <p class="text-lg">${result.error}</p>
                        </div>
                    `;
                } else {
                    const isFraud = result.prediction === 'Fraudulent Transaction';
                    const cardClass = isFraud ? 'result-fraud' : 'result-safe';
                    const icon = isFraud ? 
                        `<svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>` :
                        `<svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`;
                    
                    resultCardHTML = `
                        <div class="result-card ${cardClass}" style="display: block;">
                            ${icon}
                            <h3 class="text-3xl font-bold mb-2">${result.prediction}</h3>
                            <p class="text-lg">Confidence Score: <strong>${result.confidence}</strong></p>
                        </div>
                    `;
                }
                resultArea.innerHTML = resultCardHTML;
                resultArea.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
